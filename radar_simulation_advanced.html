<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高级雷达威力仿真演示 - 作者: duudu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }



        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .author {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .radar-display {
            grid-row: span 2;
        }

        .radar-canvas {
            width: 100%;
            height: 400px;
            background: radial-gradient(circle at center, rgba(0,255,0,0.1) 0%, rgba(0,100,0,0.05) 50%, transparent 100%);
            border-radius: 50%;
            position: relative;
            margin: 20px 0;
            border: 2px solid rgba(0,255,0,0.3);
        }

        .radar-sweep {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 2px;
            height: 50%;
            background: linear-gradient(to top, rgba(0,255,0,0.8), transparent);
            transform-origin: bottom center;
            transform: translate(-50%, -100%) rotate(0deg);
            animation: sweep-circular 3s linear infinite;
        }

        @keyframes sweep-circular {
            from { transform: translate(-50%, -100%) rotate(0deg); }
            to { transform: translate(-50%, -100%) rotate(360deg); }
        }

        @keyframes sweep-sector {
            0% { transform: translate(-50%, -100%) rotate(-45deg); }
            50% { transform: translate(-50%, -100%) rotate(45deg); }
            100% { transform: translate(-50%, -100%) rotate(-45deg); }
        }

        @keyframes sweep-track {
            0% { transform: translate(-50%, -100%) rotate(0deg); }
            25% { transform: translate(-50%, -100%) rotate(10deg); }
            50% { transform: translate(-50%, -100%) rotate(0deg); }
            75% { transform: translate(-50%, -100%) rotate(-10deg); }
            100% { transform: translate(-50%, -100%) rotate(0deg); }
        }

        @keyframes sweep-search {
            0% { transform: translate(-50%, -100%) rotate(0deg); }
            20% { transform: translate(-50%, -100%) rotate(72deg); }
            40% { transform: translate(-50%, -100%) rotate(144deg); }
            60% { transform: translate(-50%, -100%) rotate(216deg); }
            80% { transform: translate(-50%, -100%) rotate(288deg); }
            100% { transform: translate(-50%, -100%) rotate(360deg); }
        }

        .range-rings {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .range-ring {
            position: absolute;
            border: 1px solid rgba(0,255,0,0.2);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .target {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ff4444;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px #ff4444;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.5; transform: translate(-50%, -50%) scale(1.2); }
        }

        .parameter {
            margin-bottom: 15px;
        }

        .parameter label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .parameter input[type="range"] {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255,255,255,0.2);
            outline: none;
            margin-bottom: 3px;
        }

        .parameter input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(76,175,80,0.5);
        }

        .parameter select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 0.9em;
        }

        .parameter-value {
            text-align: right;
            font-size: 0.8em;
            opacity: 0.8;
        }

        .results {
            grid-column: 1 / -1;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
            position: relative;
            cursor: help;
        }

        .result-item:hover {
            background: rgba(0,0,0,0.3);
            transform: translateY(-1px);
            transition: all 0.3s ease;
        }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-line;
            max-width: 300px;
            width: max-content;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(76,175,80,0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip::before {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0,0,0,0.9);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .tooltip:hover::after,
        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
        }

        .result-value {
            font-weight: bold;
            color: #4CAF50;
        }

        .formula {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            border-left: 4px solid #4CAF50;
            font-size: 0.9em;
        }

        .chart-container {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .chart {
            width: 100%;
            height: 300px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .waveform-display {
            height: 200px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(76,175,80,0.3);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(76,175,80,0.4);
        }

        .btn-reset {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            box-shadow: 0 2px 10px rgba(255,107,107,0.3);
        }

        .btn-reset:hover {
            box-shadow: 0 4px 15px rgba(255,107,107,0.4);
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab-btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #4CAF50;
            box-shadow: 0 0 10px rgba(76,175,80,0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .performance-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .indicator-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .indicator-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffaa00, #4CAF50);
            transition: width 0.3s ease;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
        
        .parameter-readonly {
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .compression-ratio-display {
            text-align: center;
        }
        
        .compression-ratio-display .result-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #FFD700;
            display: block;
            margin-bottom: 5px;
        }
        
        .formula-hint {
            color: rgba(255,255,255,0.7);
            font-size: 0.8em;
            font-style: italic;
        }
        
        .performance-summary {
            background: linear-gradient(135deg, rgba(76,175,80,0.1), rgba(33,150,243,0.1));
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .performance-score {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        

        

        
        .score-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .score-category {
            min-width: 80px;
            font-weight: bold;
            color: rgba(255,255,255,0.9);
        }
        
        .score-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffaa00, #4CAF50);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .score-text {
            min-width: 50px;
            font-weight: bold;
            text-align: center;
        }
        
        /* 计算详情样式 */
        .calculation-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .calculation-section {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .calculation-section h4 {
            margin: 0 0 15px 0;
            color: #4CAF50;
            font-size: 1.1em;
            border-bottom: 1px solid rgba(76,175,80,0.3);
            padding-bottom: 5px;
        }
        
        .calculation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }
        
        .calc-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 4px;
            border-left: 3px solid rgba(76,175,80,0.5);
        }
        
        .calc-item.calc-total {
            background: rgba(76,175,80,0.1);
            border-left-color: #4CAF50;
            font-weight: bold;
        }
        
        .calc-item.calc-final {
            background: rgba(255,193,7,0.1);
            border-left-color: #FFC107;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .calc-label {
            color: rgba(255,255,255,0.9);
            font-size: 0.9em;
        }
        
        .calc-value {
            color: #4CAF50;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-align: right;
        }
        
        .calc-total .calc-value {
            color: #66BB6A;
        }
        
        .calc-final .calc-value {
            color: #FFC107;
        }
        
        @media (max-width: 768px) {
            .performance-score {
                flex-direction: column;
                gap: 20px;
            }
            
            .score-circle {
                width: 100px;
                height: 100px;
            }
            
            .score-circle::before {
                 width: 75px;
                 height: 75px;
             }
         }
         
         .blind-zone-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
             gap: 10px;
             margin-top: 15px;
         }
         
         .blind-zone-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            border-left: 3px solid #ff6b6b;
            position: relative;
        }

        .blind-zone-item:hover {
            background: rgba(0,0,0,0.3);
            transform: translateY(-1px);
            transition: all 0.3s ease;
        }

        .blind-zone-item.tooltip {
            cursor: help;
        }
         
         .blind-zone-value {
             font-weight: bold;
             color: #ff6b6b;
         }
         
         .results h4 {
             color: #ff6b6b;
             margin: 20px 0 10px 0;
             font-size: 1.1em;
             display: flex;
             align-items: center;
             gap: 8px;
         }
         
         /* Tooltip样式 */
         .tooltip {
             position: relative;
             cursor: help;
         }
         
         .tooltip::after {
             content: attr(data-tooltip);
             position: absolute;
             bottom: 125%;
             left: 50%;
             transform: translateX(-50%);
             background: rgba(0, 0, 0, 0.9);
             color: white;
             padding: 8px 12px;
             border-radius: 6px;
             font-size: 0.85em;
             white-space: nowrap;
             opacity: 0;
             visibility: hidden;
             transition: opacity 0.3s, visibility 0.3s;
             z-index: 1000;
             pointer-events: none;
         }
         
         .tooltip::before {
             content: '';
             position: absolute;
             bottom: 115%;
             left: 50%;
             transform: translateX(-50%);
             border: 5px solid transparent;
             border-top-color: rgba(0, 0, 0, 0.9);
             opacity: 0;
             visibility: hidden;
             transition: opacity 0.3s, visibility 0.3s;
         }
         
         .tooltip:hover::after,
         .tooltip:hover::before {
             opacity: 1;
             visibility: visible;
         }
         
         /* 参数输入框样式 */
         .parameter-input-group {
             display: flex;
             align-items: center;
             gap: 10px;
             margin-top: 5px;
         }
         
         .parameter-manual-input {
             width: 80px;
             padding: 4px 8px;
             border: 1px solid rgba(255,255,255,0.3);
             border-radius: 4px;
             background: rgba(255,255,255,0.1);
             color: white;
             font-size: 0.9em;
             text-align: center;
         }
         
         .parameter-manual-input:focus {
             outline: none;
             border-color: #4CAF50;
             background: rgba(255,255,255,0.15);
         }
         
         .parameter-apply-btn {
             padding: 4px 8px;
             background: #4CAF50;
             color: white;
             border: none;
             border-radius: 4px;
             cursor: pointer;
             font-size: 0.8em;
             transition: background 0.3s;
         }
         
         .parameter-apply-btn:hover {
             background: #45a049;
         }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 高级雷达威力仿真演示</h1>
            <div class="author">作者: duudu</div>
            <div class="formula">
                R<sub>max</sub> = ⁴√[(P<sub>t</sub> × G<sub>t</sub> × G<sub>r</sub> × λ² × σ × G<sub>pc</sub> × G<sub>ci</sub> × G<sub>nci</sub> × τ) / (k × T × F × L × SNR × (4π)³ × L<sub>cfar</sub>)]
            </div>
        </div>

        <div class="main-content">
            <div class="panel radar-display">
                <h3>🎯 雷达显示器</h3>
                <div class="radar-canvas" id="radarCanvas">
                    <div class="radar-sweep"></div>
                    <div class="range-rings" id="rangeRings"></div>
                    <div class="target" id="target"></div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <span>最大探测距离: <span id="maxRangeDisplay" style="color: #4CAF50; font-weight: bold;">0 km</span></span>
                </div>
                
                <div class="performance-indicator">
                    <span>系统性能:</span>
                    <div class="indicator-bar">
                        <div class="indicator-fill" id="performanceBar" style="width: 0%"></div>
                    </div>
                    <span id="performanceText">0%</span>
                </div>

                <div class="waveform-display" id="waveformDisplay">
                    <canvas id="waveformCanvas" width="300" height="180"></canvas>
                </div>
            </div>

            <div class="panel">
                <h3>📊 雷达方程计算详情</h3>
                <div class="calculation-details">
                    <div class="calculation-section">
                        <h4>分子部分 (Numerator)</h4>
                        <div class="calculation-grid">
                            <div class="calc-item">
                                <span class="calc-label">发射功率 P<sub>t</sub>:</span>
                                <span class="calc-value" id="ptCalc">0 W (0 dB)</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">发射增益 G<sub>t</sub>:</span>
                                <span class="calc-value" id="gtCalc">0 dB</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">接收增益 G<sub>r</sub>:</span>
                                <span class="calc-value" id="grCalc">0 dB</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">波长² λ²:</span>
                                <span class="calc-value" id="lambdaCalc">0 m² (0 dB)</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">目标RCS σ:</span>
                                <span class="calc-value" id="sigmaCalc">0 m² (0 dB)</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">脉冲宽度 τ:</span>
                                <span class="calc-value" id="tauCalc">0 μs (0 dB)</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">脉冲压缩增益:</span>
                                <span class="calc-value" id="pcGainCalc">0 dB</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">相干积累增益:</span>
                                <span class="calc-value" id="ciGainCalc">0 dB</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">非相干积累增益:</span>
                                <span class="calc-value" id="nciGainCalc">0 dB</span>
                            </div>
                            <div class="calc-item calc-total">
                                <span class="calc-label">分子总和:</span>
                                <span class="calc-value" id="numeratorTotal">0 dB</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="calculation-section">
                        <h4>分母部分 (Denominator)</h4>
                        <div class="calculation-grid">
                            <div class="calc-item">
                                <span class="calc-label">玻尔兹曼常数 k:</span>
                                <span class="calc-value" id="kCalc">1.38×10⁻²³ J/K (0 dB)</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">噪声温度 T:</span>
                                <span class="calc-value" id="tCalc">290 K (0 dB)</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">噪声系数 F:</span>
                                <span class="calc-value" id="fCalc">0 dB</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">系统损耗 L:</span>
                                <span class="calc-value" id="lCalc">0 dB</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">信噪比要求 SNR:</span>
                                <span class="calc-value" id="snrCalc">0 dB</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">几何因子 (4π)³:</span>
                                <span class="calc-value" id="geometryCalc">248.7 (0 dB)</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">CFAR损失:</span>
                                <span class="calc-value" id="cfarCalc">0 dB</span>
                            </div>
                            <div class="calc-item calc-total">
                                <span class="calc-label">分母总和:</span>
                                <span class="calc-value" id="denominatorTotal">0 dB</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="calculation-section">
                        <h4>最终计算</h4>
                        <div class="calculation-grid">
                            <div class="calc-item">
                                <span class="calc-label">R⁴ (dB):</span>
                                <span class="calc-value" id="r4dbCalc">0 dB</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">R⁴ (线性):</span>
                                <span class="calc-value" id="r4linearCalc">0</span>
                            </div>
                            <div class="calc-item calc-final">
                                <span class="calc-label">最大探测距离 R:</span>
                                <span class="calc-value" id="finalRangeCalc">0 km</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="switchTab('basic')">基本参数</button>
                        <button class="tab-btn" onclick="switchTab('signal')">信号处理</button>
                    </div>
                    
                    <div class="tab-content active" id="basic-tab">
                        <div class="parameter">
                            <label for="pt" class="tooltip" data-tooltip="雷达发射机的峰值功率，直接影响探测距离。典型值：100W-2kW">发射功率 P<sub>t</sub> (W)</label>
                            <input type="range" id="pt" min="100" max="2000" value="480" step="10">
                            <div class="parameter-value" id="ptValue">480 W</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="ptInput" min="100" max="2000" step="10" placeholder="480">
                                <button class="parameter-apply-btn" onclick="applyManualInput('pt')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="gt" class="tooltip" data-tooltip="发射天线的功率增益，决定能量集中程度。高增益天线探测距离更远">发射天线增益 G<sub>t</sub> (dB)</label>
                            <input type="range" id="gt" min="15" max="40" value="25.6" step="0.1">
                            <div class="parameter-value" id="gtValue">25.6 dB</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="gtInput" min="15" max="40" step="0.1" placeholder="25.6">
                                <button class="parameter-apply-btn" onclick="applyManualInput('gt')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="gr" class="tooltip" data-tooltip="接收天线的功率增益，影响接收信号强度。通常与发射天线相同或更高">接收天线增益 G<sub>r</sub> (dB)</label>
                            <input type="range" id="gr" min="20" max="45" value="34" step="0.1">
                            <div class="parameter-value" id="grValue">34 dB</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="grInput" min="20" max="45" step="0.1" placeholder="34">
                                <button class="parameter-apply-btn" onclick="applyManualInput('gr')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="sigma" class="tooltip" data-tooltip="目标雷达截面积，表示目标反射雷达波的能力。战斗机约1-10m²，隐身目标<0.1m²">目标RCS σ (m²)</label>
                            <input type="range" id="sigma" min="0.001" max="2" value="0.01" step="0.001">
                            <div class="parameter-value" id="sigmaValue">0.01 m²</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="sigmaInput" min="0.001" max="2" step="0.001" placeholder="0.01">
                                <button class="parameter-apply-btn" onclick="applyManualInput('sigma')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="snr" class="tooltip" data-tooltip="检测目标所需的最小信噪比。值越小检测能力越强，但虚警率增加">信噪比要求 SNR (dB)</label>
                            <input type="range" id="snr" min="5" max="25" value="12.8" step="0.1">
                            <div class="parameter-value" id="snrValue">12.8 dB</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="snrInput" min="5" max="25" step="0.1" placeholder="12.8">
                                <button class="parameter-apply-btn" onclick="applyManualInput('snr')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="freq" class="tooltip" data-tooltip="雷达工作频率。低频穿透力强但分辨率低，高频分辨率高但易受天气影响">工作频率 (GHz)</label>
                            <input type="range" id="freq" min="0.3" max="18" value="10" step="0.1">
                            <div class="parameter-value" id="freqValue">10 GHz</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="freqInput" min="0.3" max="18" step="0.1" placeholder="10">
                                <button class="parameter-apply-btn" onclick="applyManualInput('freq')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="noiseFigure" class="tooltip" data-tooltip="系统噪声系数，表示接收机引入的噪声。典型值：1-10dB，值越小系统性能越好">噪声系数 F (dB)</label>
                            <input type="range" id="noiseFigure" min="1" max="15" value="4" step="0.1">
                            <div class="parameter-value" id="noiseFigureValue">4 dB</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="noiseFigureInput" min="1" max="15" step="0.1" placeholder="4">
                                <button class="parameter-apply-btn" onclick="applyManualInput('noiseFigure')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="systemLoss" class="tooltip" data-tooltip="系统链路损耗，包括馈线损耗、开关损耗、大气损耗等。典型值：3-15dB">系统损耗 L (dB)</label>
                            <input type="range" id="systemLoss" min="3" max="20" value="8.24" step="0.1">
                            <div class="parameter-value" id="systemLossValue">8.24 dB</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="systemLossInput" min="3" max="20" step="0.1" placeholder="8.24">
                                <button class="parameter-apply-btn" onclick="applyManualInput('systemLoss')">应用</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="signal-tab">
                        <div class="parameter">
                            <label for="pulseCompression" class="tooltip" data-tooltip="脉冲压缩比=脉宽×带宽，提高距离分辨率和信噪比。典型值：10-10000">脉冲压缩比 (自动计算)</label>
                            <div class="parameter-readonly">
                                <div class="compression-ratio-display">
                                    <span class="result-value" id="pulseCompressionValue">100</span>
                                    <small class="formula-hint">(τ × B = 脉冲宽度 × 带宽)</small>
                                </div>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="coherentIntegration" class="tooltip" data-tooltip="相干积累脉冲数，提高信噪比。增益=10×log₁₀(N) dB，受PRF和驻留时间限制">相干积累脉冲数</label>
                            <input type="range" id="coherentIntegration" min="1" max="256" value="192" step="1">
                            <div class="parameter-value" id="coherentIntegrationValue">192</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="coherentIntegrationInput" min="1" max="256" step="1" placeholder="192">
                                <button class="parameter-apply-btn" onclick="applyManualInput('coherentIntegration')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="nonCoherentIntegration" class="tooltip" data-tooltip="非相干积累次数，进一步提高信噪比。增益=5×log₁₀(M) dB，但会增加处理时间">非相干积累次数</label>
                            <input type="range" id="nonCoherentIntegration" min="0" max="64" value="0" step="1">
                            <div class="parameter-value" id="nonCoherentIntegrationValue">0</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="nonCoherentIntegrationInput" min="0" max="64" step="1" placeholder="0">
                                <button class="parameter-apply-btn" onclick="applyManualInput('nonCoherentIntegration')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="cfarType" class="tooltip" data-tooltip="恒虚警率检测器类型。CA-CFAR适用均匀杂波，GO/SO-CFAR适用多目标环境">CFAR类型</label>
                            <select id="cfarType">
                                <option value="ca">CA-CFAR</option>
                                <option value="go">GO-CFAR</option>
                                <option value="so">SO-CFAR</option>
                                <option value="os">OS-CFAR</option>
                            </select>
                        </div>

                        <div class="parameter">
                            <label for="cfarLoss" class="tooltip" data-tooltip="CFAR处理引入的检测损失，通常1-3dB。损失越小检测性能越好">CFAR损失 (dB)</label>
                            <input type="range" id="cfarLoss" min="0" max="6" value="0" step="0.1">
                            <div class="parameter-value" id="cfarLossValue">0 dB</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="cfarLossInput" min="0" max="6" step="0.1" placeholder="0">
                                <button class="parameter-apply-btn" onclick="applyManualInput('cfarLoss')">应用</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="switchTab('waveform', this.parentElement)">波形参数</button>
                        <button class="tab-btn" onclick="switchTab('operation', this.parentElement)">工作模式</button>
                    </div>
                    
                    <div class="tab-content active" id="waveform-tab">
                        <div class="parameter">
                            <label for="waveformType" class="tooltip" data-tooltip="雷达波形类型。LFM提供脉冲压缩，相位编码抗干扰性强">波形类型</label>
                            <select id="waveformType">
                                <option value="rect">矩形脉冲</option>
                                <option value="lfm">线性调频(LFM)</option>
                                <option value="bpsk">二相编码(BPSK)</option>
                                <option value="qpsk">四相编码(QPSK)</option>
                            </select>
                        </div>

                        <div class="parameter">
                            <label for="pulseWidth" class="tooltip" data-tooltip="脉冲持续时间，影响发射能量和最小探测距离。长脉冲能量大但盲区大">脉冲宽度 (μs)</label>
                            <input type="range" id="pulseWidth" min="0.1" max="1000" value="20" step="0.1">
                            <div class="parameter-value" id="pulseWidthValue">20 μs</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="pulseWidthInput" min="0.1" max="1000" step="0.1" placeholder="20">
                                <button class="parameter-apply-btn" onclick="applyManualInput('pulseWidth')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="bandwidth" class="tooltip" data-tooltip="信号带宽，决定距离分辨率。带宽越大分辨率越高，ΔR=c/(2B)">信号带宽 (MHz)</label>
                            <input type="range" id="bandwidth" min="0.1" max="2000" value="0.1" step="0.1">
                            <div class="parameter-value" id="bandwidthValue">0.1 MHz</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="bandwidthInput" min="0.1" max="2000" step="0.1" placeholder="0.1">
                                <button class="parameter-apply-btn" onclick="applyManualInput('bandwidth')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="prf" class="tooltip" data-tooltip="脉冲重复频率，影响最大不模糊距离和多普勒性能。高PRF距离近但多普勒好">脉冲重复频率 (Hz)</label>
                            <input type="range" id="prf" min="50" max="50000" value="10000" step="10">
                            <div class="parameter-value" id="prfValue">10000 Hz</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="prfInput" min="50" max="50000" step="10" placeholder="10000">
                                <button class="parameter-apply-btn" onclick="applyManualInput('prf')">应用</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="operation-tab">
                        <div class="parameter">
                            <label for="scanMode" class="tooltip" data-tooltip="雷达扫描工作模式。圆扫用于搜索，扇扫用于监视，跟踪用于目标跟踪">扫描模式</label>
                            <select id="scanMode">
                                <option value="circular">圆扫</option>
                                <option value="sector">扇扫</option>
                                <option value="track">跟踪</option>
                                <option value="search">搜索</option>
                            </select>
                        </div>

                        <div class="parameter">
                            <label for="dwellTime" class="tooltip" data-tooltip="波束在某方向的停留时间，影响积累脉冲数和检测性能。时间越长检测越好">驻留时间 (ms)</label>
                            <input type="range" id="dwellTime" min="0.1" max="10000" value="100" step="0.1">
                            <div class="parameter-value" id="dwellTimeValue">100 ms</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="dwellTimeInput" min="0.1" max="10000" step="0.1" placeholder="100">
                                <button class="parameter-apply-btn" onclick="applyManualInput('dwellTime')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="beamWidth" class="tooltip" data-tooltip="天线波束宽度，影响角分辨率和增益。窄波束增益高但扫描慢">波束宽度 (°)</label>
                            <input type="range" id="beamWidth" min="0.5" max="10" value="2" step="0.1">
                            <div class="parameter-value" id="beamWidthValue">2°</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="beamWidthInput" min="0.5" max="10" step="0.1" placeholder="2">
                                <button class="parameter-apply-btn" onclick="applyManualInput('beamWidth')">应用</button>
                            </div>
                        </div>

                        <div class="parameter">
                            <label for="scanRate" class="tooltip" data-tooltip="天线扫描速度，影响数据更新率。快扫描更新快但驻留时间短">扫描速率 (°/s)</label>
                            <input type="range" id="scanRate" min="1" max="360" value="60" step="1">
                            <div class="parameter-value" id="scanRateValue">60 °/s</div>
                            <div class="parameter-input-group">
                                <input type="number" class="parameter-manual-input" id="scanRateInput" min="1" max="360" step="1" placeholder="60">
                                <button class="parameter-apply-btn" onclick="applyManualInput('scanRate')">应用</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-reset" onclick="resetParameters()">🔄 重置参数</button>
            </div>
        </div>

        <div class="panel results">
            <h3>📊 性能分析结果</h3>
            <div class="performance-summary" id="performanceSummary">
                <div class="performance-score">
                    <div class="score-details">
                        <div class="score-item">
                            <span class="score-category">探测能力:</span>
                            <div class="score-bar">
                                <div class="score-fill" id="detectionScore" style="width: 80%"></div>
                            </div>
                            <span class="score-text" id="detectionText">良好</span>
                        </div>
                        <div class="score-item">
                            <span class="score-category">分辨性能:</span>
                            <div class="score-bar">
                                <div class="score-fill" id="resolutionScore" style="width: 90%"></div>
                            </div>
                            <span class="score-text" id="resolutionText">优秀</span>
                        </div>
                        <div class="score-item">
                            <span class="score-category">系统效率:</span>
                            <div class="score-bar">
                                <div class="score-fill" id="efficiencyScore" style="width: 75%"></div>
                            </div>
                            <span class="score-text" id="efficiencyText">良好</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="result-grid">
                <div class="result-item tooltip" data-tooltip="雷达能够探测到目标的最大距离\n计算公式: R = [(Pt×Gt×Gr×σ×λ²×G)/(4π)³×k×T×F×L×SNR]^(1/4)\n其中G为总信号处理增益">
                    <span>最大探测距离:</span>
                    <span class="result-value" id="maxRange">0 km</span>
                </div>
                <div class="result-item tooltip" data-tooltip="电磁波在自由空间中的波长\n计算公式: λ = c/f\n其中c为光速(3×10⁸ m/s)，f为工作频率">
                    <span>波长:</span>
                    <span class="result-value" id="wavelength">0 m</span>
                </div>
                <div class="result-item tooltip" data-tooltip="脉冲压缩技术带来的信噪比改善\n计算公式: G_pc = 10×log₁₀(B×τ)\n其中B为信号带宽，τ为脉冲宽度\n矩形脉冲时增益为0 dB">
                    <span>脉冲压缩增益:</span>
                    <span class="result-value" id="pcGain">0 dB</span>
                </div>
                <div class="result-item tooltip" data-tooltip="相干积累处理带来的信噪比改善\n计算公式: G_ci = 10×log₁₀(N)\n其中N为实际相干积累脉冲数\n受驻留时间、PRF和处理能力限制">
                    <span>相干积累增益:</span>
                    <span class="result-value" id="ciGain">0 dB</span>
                </div>
                <div class="result-item tooltip" data-tooltip="非相干积累处理带来的信噪比改善\n计算公式: G_nci = 5×log₁₀(M)\n其中M为非相干积累次数\n改善效果比相干积累差">
                    <span>非相干积累增益:</span>
                    <span class="result-value" id="nciGain">0 dB</span>
                </div>
                <div class="result-item tooltip" data-tooltip="所有信号处理技术的总增益\n计算公式: G_total = G_pc + G_ci + G_nci\n直接影响雷达的探测距离">
                    <span>总信号处理增益:</span>
                    <span class="result-value" id="totalGain">0 dB</span>
                </div>
                <div class="result-item tooltip" data-tooltip="在给定信噪比下检测到目标的概率\n基于Swerling目标模型计算\n与信噪比、积累次数相关">
                    <span>检测概率:</span>
                    <span class="result-value" id="detectionProb">0%</span>
                </div>
                <div class="result-item tooltip" data-tooltip="将噪声误判为目标的概率\n由CFAR检测算法控制\n典型值为10⁻⁶到10⁻⁴">
                    <span>虚警概率:</span>
                    <span class="result-value" id="falseAlarmProb">0</span>
                </div>
                <div class="result-item tooltip" data-tooltip="雷达能够分辨的最小距离间隔\n计算公式: ΔR = c/(2×B)\n其中c为光速，B为信号带宽">
                    <span>距离分辨率:</span>
                    <span class="result-value" id="rangeResolution">0 m</span>
                </div>
                <div class="result-item tooltip" data-tooltip="不产生距离模糊的最大探测距离\n计算公式: R_max = c/(2×PRF)\n其中PRF为脉冲重复频率">
                <span>最大不模糊距离:</span>
                <span class="result-value" id="maxUnambiguousRange">0 km</span>
            </div>
            <div class="result-item tooltip" data-tooltip="在驻留时间内实际可用的脉冲数\n受驻留时间、PRF和处理能力限制\n影响相干积累增益的计算">
                <span>可用积累脉冲数:</span>
                <span class="result-value" id="availablePulses">0</span>
            </div>
            <div class="result-item tooltip" data-tooltip="实际积累脉冲数与设定值的比率\n计算公式: η = N_actual/N_set×100%\n反映系统参数设置的合理性">
                <span>PRF效率:</span>
                <span class="result-value" id="prfEfficiency">100%</span>
            </div>
            <div class="result-item tooltip" data-tooltip="距离约束条件的满足情况\n检查: 最大探测距离 ≤ 最大不模糊距离\n确保测距结果的唯一性">
                    <span>距离约束状态:</span>
                    <span class="result-value" id="constraintStatus">✓ 满足</span>
                </div>
                <div class="result-item">
                    <span>理论验证:</span>
                    <span class="result-value" id="theoryValidation">✓ 公式正确</span>
                </div>
            </div>
            
            <h4>🚫 雷达探测盲区分析</h4>
            <div class="blind-zone-grid">
                <div class="blind-zone-item tooltip" data-tooltip="雷达无法探测到目标的最小距离\n计算公式: R_min = c×τ/2\n其中c为光速，τ为脉冲宽度\n主要由发射脉冲宽度决定">
                    <span>最小探测距离:</span>
                    <span class="blind-zone-value" id="minDetectionRange">0.15 km</span>
                </div>
                <div class="blind-zone-item tooltip" data-tooltip="由于距离模糊造成的探测盲区\n当最大探测距离 > 最大不模糊距离时出现\n计算: R_max - R_unambiguous\n需要调整PRF来避免">
                    <span>距离模糊盲区:</span>
                    <span class="blind-zone-value" id="rangeAmbiguityBlind">无</span>
                </div>
                <div class="blind-zone-item tooltip" data-tooltip="第一个多普勒盲速值\n计算公式: v_blind = λ×PRF/2\n其中λ为波长，PRF为脉冲重复频率\n目标速度为此值的整数倍时无法检测">
                    <span>第一盲速:</span>
                    <span class="blind-zone-value" id="firstBlindSpeed">0 m/s</span>
                </div>
                <div class="blind-zone-item tooltip" data-tooltip="在指定速度范围内的多普勒盲区数量\n计算范围: ±100 m/s\n计算公式: N = floor(2×V_max/v_blind) + 1\n盲区数量越多，检测盲区越严重">
                    <span>多普勒盲区数:</span>
                    <span class="blind-zone-value" id="dopplerBlindZones">5</span>
                </div>
                <div class="blind-zone-item tooltip" data-tooltip="天线波束宽度造成的角度盲区\n计算公式: θ_blind = ±BeamWidth/2\n波束宽度越窄，角度分辨率越高\n但扫描覆盖时间越长">
                    <span>角度盲区:</span>
                    <span class="blind-zone-value" id="angleBlindZone">±1.0°</span>
                </div>
                <div class="blind-zone-item tooltip" data-tooltip="各种盲区占总探测空间的比例\n综合考虑距离盲区、角度盲区等因素\n计算: (距离盲区率 + 角度盲区率) × 100%\n覆盖率越低，雷达性能越好">
                    <span>盲区覆盖率:</span>
                    <span class="blind-zone-value" id="blindZoneCoverage">5.2%</span>
                </div>
            </div>
        </div>


    </div>

    <script>
        // 作者: duudu
        // 高级雷达参数和常数
        const CONSTANTS = {
            C: 3e8,           // 光速
            K: 1.38e-23,      // 玻尔兹曼常数
            T: 290,           // 噪声温度
            F: 4,             // 噪声系数 (dB)
            L: 8.24,          // 系统损耗 (dB)
            MTD: 192          // MTD积累增益
        };

        // 获取DOM元素
        const elements = {
            // 基本参数
            pt: document.getElementById('pt'),
            gt: document.getElementById('gt'),
            gr: document.getElementById('gr'),
            sigma: document.getElementById('sigma'),
            snr: document.getElementById('snr'),
            freq: document.getElementById('freq'),
            noiseFigure: document.getElementById('noiseFigure'),
            systemLoss: document.getElementById('systemLoss'),
            
            // 信号处理参数
            coherentIntegration: document.getElementById('coherentIntegration'),
            nonCoherentIntegration: document.getElementById('nonCoherentIntegration'),
            cfarType: document.getElementById('cfarType'),
            cfarLoss: document.getElementById('cfarLoss'),
            
            // 波形参数
            waveformType: document.getElementById('waveformType'),
            pulseWidth: document.getElementById('pulseWidth'),
            bandwidth: document.getElementById('bandwidth'),
            prf: document.getElementById('prf'),
            
            // 工作模式参数
            scanMode: document.getElementById('scanMode'),
            dwellTime: document.getElementById('dwellTime'),
            beamWidth: document.getElementById('beamWidth'),
            scanRate: document.getElementById('scanRate'),
            
            // 显示元素
            target: document.getElementById('target'),
            rangeRings: document.getElementById('rangeRings')
        };

        // 初始化
        function init() {
            createRangeRings();
            updateCalculation();
            bindEvents();
            drawChart();
            drawWaveform();
        }

        // 绑定事件
        function bindEvents() {
            Object.keys(elements).forEach(key => {
                if (elements[key] && elements[key].addEventListener) {
                    elements[key].addEventListener('input', updateCalculation);
                    elements[key].addEventListener('change', updateCalculation);
                }
            });
        }

        // 切换标签页
        function switchTab(tabName, container = document) {
            const buttons = container.querySelectorAll('.tab-btn');
            const contents = container.querySelectorAll('.tab-content');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            const targetContent = document.getElementById(tabName + '-tab');
            if (targetContent) {
                targetContent.classList.add('active');
            }
        }

        // 创建距离环
        function createRangeRings() {
            const rangeRings = document.getElementById('rangeRings');
            rangeRings.innerHTML = '';
            
            for (let i = 1; i <= 4; i++) {
                const ring = document.createElement('div');
                ring.className = 'range-ring';
                const size = i * 80;
                ring.style.width = size + 'px';
                ring.style.height = size + 'px';
                rangeRings.appendChild(ring);
            }
        }

        // 更新计算
        function updateCalculation() {
            // 获取基本参数值
            const pt = parseFloat(elements.pt.value);
            const gt = parseFloat(elements.gt.value);
            const gr = parseFloat(elements.gr.value);
            const sigma = parseFloat(elements.sigma.value);
            const snr = parseFloat(elements.snr.value);
            const freq = parseFloat(elements.freq.value) * 1e9;
            const noiseFigure = parseFloat(elements.noiseFigure.value);
            const systemLoss = parseFloat(elements.systemLoss.value);
            
            // 获取信号处理参数
            const coherentIntegration = parseFloat(elements.coherentIntegration.value);
            const nonCoherentIntegration = parseFloat(elements.nonCoherentIntegration.value);
            const cfarLoss = parseFloat(elements.cfarLoss.value);
            
            // 获取波形参数
            const waveformType = elements.waveformType.value;
            const pulseWidth = parseFloat(elements.pulseWidth.value) * 1e-6;
            const bandwidth = parseFloat(elements.bandwidth.value) * 1e6;
            const prf = parseFloat(elements.prf.value);
            
            // 获取工作模式参数
            const dwellTime = parseFloat(elements.dwellTime.value) * 1e-3;
            const beamWidth = parseFloat(elements.beamWidth.value);
            const scanRate = parseFloat(elements.scanRate.value);

            // 更新显示值
            updateDisplayValues();

            // 计算波长
            const lambda = CONSTANTS.C / freq;
            document.getElementById('wavelength').textContent = (lambda * 100).toFixed(2) + ' cm';

            // 根据波形类型计算脉冲压缩比
            let pulseCompression;
            if (waveformType === 'rect') {
                // 矩形脉冲没有脉冲压缩
                pulseCompression = 1;
            } else {
                // 其他波形类型：LFM、BPSK、QPSK等有脉冲压缩
                pulseCompression = Math.max(1, pulseWidth * bandwidth);
            }
            
            // 更新脉冲压缩比显示
            document.getElementById('pulseCompressionValue').textContent = pulseCompression.toFixed(0);
            
            // 计算实际可用的相干积累脉冲数（考虑多种工程约束）
            
            // 1. 驻留时间内的理论最大脉冲数
            const maxAvailablePulses = Math.max(1, Math.floor(dwellTime * prf));
            
            // 2. 相干时间限制（基于目标运动和系统稳定性）
            // 假设相干时间约为10-100ms，取决于频率和目标特性
            const coherentTimeLimit = Math.min(0.1, 1.0 / freq * 1e9 * 100); // 相干时间限制
            const maxCoherentPulses = Math.max(1, Math.floor(coherentTimeLimit * prf));
            
            // 3. 系统处理能力限制（假设最大处理512个脉冲）
            const maxProcessingPulses = 512;
            
            // 4. 多普勒带宽限制（避免跨越多个多普勒滤波器）
            const dopplerBandwidth = prf / 2; // 最大不模糊多普勒频率
            const maxDopplerPulses = Math.max(1, Math.floor(dopplerBandwidth / 10)); // 保守估计
            
            // 5. 综合所有约束条件，取最小值
            const actualCoherentIntegration = Math.max(1, Math.min(
                coherentIntegration,        // 用户设定值
                maxAvailablePulses,         // 驻留时间限制
                maxCoherentPulses,          // 相干时间限制
                maxProcessingPulses,        // 处理能力限制
                maxDopplerPulses            // 多普勒带宽限制
            ));
            
            // 计算各种限制因子
            const dwellTimeLimited = actualCoherentIntegration === maxAvailablePulses;
            const coherentTimeLimited = actualCoherentIntegration === maxCoherentPulses;
            const processingLimited = actualCoherentIntegration === maxProcessingPulses;
            const dopplerLimited = actualCoherentIntegration === maxDopplerPulses;
            
            // 调试信息
            console.log('相干积累约束分析:', {
                '设定值': coherentIntegration,
                '驻留时间限制': maxAvailablePulses,
                '相干时间限制': maxCoherentPulses,
                '处理能力限制': maxProcessingPulses,
                '多普勒限制': maxDopplerPulses,
                '实际使用': actualCoherentIntegration,
                '主要限制因子': dwellTimeLimited ? '驻留时间' : 
                              coherentTimeLimited ? '相干时间' :
                              processingLimited ? '处理能力' :
                              dopplerLimited ? '多普勒带宽' : '用户设定'
            });
            
            // 计算信号处理增益
            const pcGain = 10 * Math.log10(Math.max(1, pulseCompression));
            const ciGain = 10 * Math.log10(actualCoherentIntegration);
            // 非相干积累增益：5 × log10(N) - 理论公式，当N=0时增益为0
            const nciGain = nonCoherentIntegration > 0 ? 5 * Math.log10(nonCoherentIntegration) : 0;
            
            // PRF对脉冲能量的影响（占空比效应）
            const dutyCycle = pulseWidth * prf;
            const dutyCycleGain = dutyCycle < 0.1 ? 10 * Math.log10(dutyCycle / 0.01) : 0; // 基准占空比1%
            
            const totalGain = pcGain + ciGain + nciGain + dutyCycleGain;
            
            // 更新增益显示
            document.getElementById('pcGain').textContent = pcGain.toFixed(1) + ' dB (10×log₁₀(' + pulseCompression + '))';
            
            // 相干积累增益显示，包含限制因子信息
            let ciGainText = ciGain.toFixed(1) + ' dB (实际:' + actualCoherentIntegration + '/' + coherentIntegration + ')';
            let ciGainColor = '#4CAF50';
            let ciGainTitle = '';
            
            // 根据限制因子设置颜色和提示
            if (actualCoherentIntegration < coherentIntegration) {
                ciGainColor = '#ff9800';
                if (dwellTimeLimited) {
                    ciGainTitle = '受驻留时间限制：需要' + (coherentIntegration / prf * 1000).toFixed(1) + 'ms驻留时间';
                } else if (coherentTimeLimited) {
                    ciGainTitle = '受相干时间限制：目标运动或系统不稳定';
                } else if (processingLimited) {
                    ciGainTitle = '受处理能力限制：系统最大处理' + maxProcessingPulses + '个脉冲';
                } else if (dopplerLimited) {
                    ciGainTitle = '受多普勒带宽限制：避免跨越滤波器';
                }
            } else {
                ciGainTitle = '相干积累未受限制，性能最优';
            }
            
            document.getElementById('ciGain').textContent = ciGainText;
            document.getElementById('ciGain').style.color = ciGainColor;
            document.getElementById('ciGain').title = ciGainTitle;
            
            document.getElementById('nciGain').textContent = nciGain.toFixed(1) + ' dB (5×log₁₀(' + nonCoherentIntegration + '))';
            document.getElementById('totalGain').textContent = totalGain.toFixed(1) + ' dB';
            
            // 计算相干积累效率
            const coherentEfficiency = actualCoherentIntegration / Math.max(1, coherentIntegration);

            // 转换为dB进行计算
            const ptDb = 10 * Math.log10(pt);
            const sigmaDb = 10 * Math.log10(sigma);
            const mtdDb = 10 * Math.log10(CONSTANTS.MTD);
            const pulseWidthDb = 10 * Math.log10(pulseWidth);
            const lambdaDb = 20 * Math.log10(lambda);
            
            const kDb = 10 * Math.log10(CONSTANTS.K);
            const tDb = 10 * Math.log10(CONSTANTS.T);
            const zfDb = 10 * Math.log10(Math.pow(4 * Math.PI, 3));

            // 计算分子和分母（包含信号处理增益）
            const numerator = ptDb + gt + gr + sigmaDb + mtdDb + pulseWidthDb + lambdaDb + totalGain;
            const denominator = kDb + tDb + noiseFigure + systemLoss + snr + zfDb + cfarLoss;
            
            // 计算R^4 (dB)
            const r4db = numerator - denominator;
            
            // 计算最大探测距离
            const r4 = Math.pow(10, r4db / 10);
            const maxRange = Math.pow(r4, 1/4) / 1000; // 转换为km

            // 更新计算详情显示并获取修正后的探测距离
            const correctedMaxRange = updateCalculationDetails({
                pt, gt, gr, sigma, lambda, pulseWidth, noiseFigure, systemLoss, snr, cfarLoss,
                ptDb, sigmaDb, pulseWidthDb, lambdaDb, kDb, tDb, zfDb,
                pcGain, ciGain, nciGain, numerator, denominator, r4db, r4, maxRange
            });

            // 计算其他性能参数
            const rangeResolution = CONSTANTS.C / (2 * bandwidth);
            const maxUnambiguousRange = CONSTANTS.C / (2 * prf) / 1000;
            const detectionProb = calculateDetectionProbability(snr, coherentIntegration, nonCoherentIntegration);
            const falseAlarmProb = calculateFalseAlarmProbability(elements.cfarType.value);
            
            // 计算有效探测距离（取最大探测距离和最大不模糊距离的较小值）
            const effectiveRange = Math.min(correctedMaxRange, maxUnambiguousRange);
            
            // 更新显示
            document.getElementById('maxRange').textContent = correctedMaxRange.toFixed(2) + ' km';
            document.getElementById('maxRangeDisplay').textContent = effectiveRange.toFixed(2) + ' km';
            document.getElementById('rangeResolution').textContent = rangeResolution.toFixed(1) + ' m';
            document.getElementById('maxUnambiguousRange').textContent = maxUnambiguousRange.toFixed(1) + ' km';
            document.getElementById('detectionProb').textContent = (detectionProb * 100).toFixed(1) + '%';
            document.getElementById('falseAlarmProb').textContent = falseAlarmProb.toExponential(2);
            document.getElementById('availablePulses').textContent = maxAvailablePulses;
            document.getElementById('prfEfficiency').textContent = (prfEfficiency * 100).toFixed(0) + '%';
            
            // 更新约束状态显示
            const constraintStatus = document.getElementById('constraintStatus');
            if (correctedMaxRange > maxUnambiguousRange) {
                constraintStatus.textContent = '⚠️ 违反';
                constraintStatus.style.color = '#ff4444';
                constraintStatus.title = '探测距离超过不模糊距离';
            } else {
                constraintStatus.textContent = '✓ 满足';
                constraintStatus.style.color = '#4CAF50';
                constraintStatus.title = '距离约束满足';
            }
            
            // 检查距离约束：最大探测距离应小于最大不模糊距离
            checkRangeConstraint(correctedMaxRange, maxUnambiguousRange);
            
            // 理论验证
            validateTheory(pcGain, ciGain, nciGain, pulseCompression, actualCoherentIntegration, nonCoherentIntegration);
            
            // 更新性能指示器
            updatePerformanceIndicator(effectiveRange, detectionProb);
            
            // 更新目标位置
            updateTargetPosition(effectiveRange);
            
            // 更新扫描动画
            updateScanAnimation();
            
            // 更新波形显示
            drawWaveform();
            
            // 更新性能分析显示
            updatePerformanceAnalysis({
                effectiveRange,
                maxRange: correctedMaxRange,
                maxUnambiguousRange,
                detectionProb,
                rangeResolution,
                totalGain,
                prfEfficiency,
                bandwidth,
                prf
            });
            
            // 更新盲区分析显示
            updateBlindZoneAnalysis({
                prf,
                freq,
                pulseWidth: parseFloat(elements.pulseWidth.value), // 传递原始微秒值
                beamWidth,
                maxRange: correctedMaxRange,
                maxUnambiguousRange,
                lambda
            });
        }

        // 更新性能分析显示
        function updatePerformanceAnalysis(params) {
            const {
                effectiveRange,
                maxRange,
                maxUnambiguousRange,
                detectionProb,
                rangeResolution,
                totalGain,
                prfEfficiency,
                bandwidth,
                prf
            } = params;
            
            // 计算各项性能评分 (0-100)
            const detectionScore = Math.min(100, Math.max(0, 
                (effectiveRange / 100) * 30 + // 探测距离贡献30%
                (detectionProb * 100) * 0.7   // 检测概率贡献70%
            ));
            
            const resolutionScore = Math.min(100, Math.max(0,
                (bandwidth / 1000) * 50 +      // 带宽贡献50%
                (1000 / Math.max(1, rangeResolution)) * 50  // 距离分辨率贡献50%
            ));
            
            const efficiencyScore = Math.min(100, Math.max(0,
                prfEfficiency * 60 +           // PRF效率贡献60%
                (totalGain / 50) * 40          // 总增益贡献40%
            ));
            
            // 更新显示
            
            updateScoreBar('detectionScore', detectionScore);
            updateScoreBar('resolutionScore', resolutionScore);
            updateScoreBar('efficiencyScore', efficiencyScore);
            
            updateScoreText('detectionText', detectionScore);
            updateScoreText('resolutionText', resolutionScore);
            updateScoreText('efficiencyText', efficiencyScore);
        }
        

        
        // 更新评分条
        function updateScoreBar(elementId, score) {
            const element = document.getElementById(elementId);
            element.style.width = score + '%';
            element.style.background = `linear-gradient(90deg, ${getScoreGradient(score)})`;
        }
        
        // 更新评分文本
        function updateScoreText(elementId, score) {
            const element = document.getElementById(elementId);
            const text = getScoreText(score);
            const color = getScoreColor(score);
            element.textContent = text;
            element.style.color = color;
        }
        
        // 获取评分颜色
        function getScoreColor(score) {
            if (score >= 80) return '#4CAF50';      // 绿色 - 优秀
            if (score >= 60) return '#FFC107';      // 黄色 - 良好
            if (score >= 40) return '#FF9800';      // 橙色 - 一般
            return '#F44336';                       // 红色 - 较差
        }
        
        // 获取评分渐变
        function getScoreGradient(score) {
            if (score >= 80) return '#4CAF50, #66BB6A';
            if (score >= 60) return '#FFC107, #FFD54F';
            if (score >= 40) return '#FF9800, #FFB74D';
            return '#F44336, #EF5350';
        }
        
        // 获取评分文本
        function getScoreText(score) {
            if (score >= 80) return '优秀';
            if (score >= 60) return '良好';
            if (score >= 40) return '一般';
            return '较差';
        }
        
        // 更新盲区分析显示
        function updateBlindZoneAnalysis(params) {
            const { prf, freq, pulseWidth, beamWidth, maxRange, maxUnambiguousRange, lambda } = params;
            
            // 计算最小探测距离（基于脉冲宽度和发射机恢复时间）
            const recoveryTime = 0.1; // 假设0.1μs恢复时间（更现实的值）
            const minRangePulse = CONSTANTS.C * pulseWidth * 1e-6 / 2 / 1000; // μs转秒，m转km
            const minRangeRecovery = CONSTANTS.C * recoveryTime * 1e-6 / 2 / 1000; // μs转秒，m转km
            const minDetectionRange = Math.max(minRangePulse, minRangeRecovery);
            
            // 计算距离模糊盲区
            const rangeAmbiguityBlind = maxRange > maxUnambiguousRange ? 
                `>${maxUnambiguousRange.toFixed(1)}km` : '无';
            
            // 计算第一盲速
            const firstBlindSpeed = lambda * prf / 2; // m/s
            
            // 计算多普勒盲区数量（在±100 m/s范围内）
            const maxVelocity = 100; // m/s
            const dopplerBlindZones = Math.floor(2 * maxVelocity / firstBlindSpeed) + 1;
            
            // 计算角度盲区（基于波束宽度）
            const angleBlindZone = beamWidth / 2;
            
            // 计算盲区覆盖率（简化估算）
            const minRangeRatio = minDetectionRange / Math.max(maxRange, 1);
            const ambiguityRatio = maxRange > maxUnambiguousRange ? 0.1 : 0;
            const angleRatio = (angleBlindZone * 2) / 360;
            const blindZoneCoverage = (minRangeRatio + ambiguityRatio + angleRatio) * 100;
            
            // 更新显示（根据数值大小选择合适的单位）
            if (minDetectionRange < 1) {
                document.getElementById('minDetectionRange').textContent = (minDetectionRange * 1000).toFixed(0) + ' m';
            } else {
                document.getElementById('minDetectionRange').textContent = minDetectionRange.toFixed(3) + ' km';
            }
            document.getElementById('rangeAmbiguityBlind').textContent = rangeAmbiguityBlind;
            document.getElementById('firstBlindSpeed').textContent = firstBlindSpeed.toFixed(1) + ' m/s';
            document.getElementById('dopplerBlindZones').textContent = Math.min(dopplerBlindZones, 20);
            document.getElementById('angleBlindZone').textContent = '±' + angleBlindZone.toFixed(1) + '°';
            document.getElementById('blindZoneCoverage').textContent = Math.min(blindZoneCoverage, 100).toFixed(1) + '%';
            
            // 根据盲区情况更新颜色
            updateBlindZoneColors({
                minDetectionRange,
                rangeAmbiguityBlind,
                blindZoneCoverage
            });
        }
        
        // 更新盲区颜色指示
        function updateBlindZoneColors(params) {
            const { minDetectionRange, rangeAmbiguityBlind, blindZoneCoverage } = params;
            
            // 最小探测距离颜色
            const minRangeElement = document.getElementById('minDetectionRange');
            if (minDetectionRange > 1.0) {
                minRangeElement.style.color = '#ff4444';
            } else if (minDetectionRange > 0.5) {
                minRangeElement.style.color = '#ff9800';
            } else {
                minRangeElement.style.color = '#4CAF50';
            }
            
            // 距离模糊盲区颜色
            const ambiguityElement = document.getElementById('rangeAmbiguityBlind');
            if (rangeAmbiguityBlind !== '无') {
                ambiguityElement.style.color = '#ff4444';
            } else {
                ambiguityElement.style.color = '#4CAF50';
            }
            
            // 盲区覆盖率颜色
            const coverageElement = document.getElementById('blindZoneCoverage');
            if (blindZoneCoverage > 20) {
                coverageElement.style.color = '#ff4444';
            } else if (blindZoneCoverage > 10) {
                coverageElement.style.color = '#ff9800';
            } else {
                coverageElement.style.color = '#4CAF50';
            }
        }
        
        // 更新显示值
        function updateDisplayValues() {
            document.getElementById('ptValue').textContent = elements.pt.value + ' W';
            document.getElementById('gtValue').textContent = elements.gt.value + ' dB';
            document.getElementById('grValue').textContent = elements.gr.value + ' dB';
            document.getElementById('sigmaValue').textContent = elements.sigma.value + ' m²';
            document.getElementById('snrValue').textContent = elements.snr.value + ' dB';
            document.getElementById('freqValue').textContent = (parseFloat(elements.freq.value)).toFixed(1) + ' GHz';
            
            document.getElementById('coherentIntegrationValue').textContent = elements.coherentIntegration.value;
            document.getElementById('nonCoherentIntegrationValue').textContent = elements.nonCoherentIntegration.value;
            document.getElementById('cfarLossValue').textContent = elements.cfarLoss.value + ' dB';
            
            document.getElementById('pulseWidthValue').textContent = elements.pulseWidth.value + ' μs';
            document.getElementById('bandwidthValue').textContent = elements.bandwidth.value + ' MHz';
            document.getElementById('prfValue').textContent = elements.prf.value + ' Hz';
            
            document.getElementById('dwellTimeValue').textContent = elements.dwellTime.value + ' ms';
            document.getElementById('beamWidthValue').textContent = elements.beamWidth.value + '°';
            document.getElementById('scanRateValue').textContent = elements.scanRate.value + ' °/s';
        }

        // 计算检测概率
        function calculateDetectionProbability(snr, ci, nci) {
            const snrLinear = Math.pow(10, snr / 10);
            const effectiveSNR = snrLinear * ci * Math.sqrt(nci);
            // 简化的检测概率计算（基于高斯近似）
            const pd = 0.5 * (1 + Math.tanh((Math.log10(effectiveSNR) - 1) * 2));
            return Math.min(Math.max(pd, 0), 1);
        }

        // 计算虚警概率
        function calculateFalseAlarmProbability(cfarType) {
            const basePfa = 1e-6;
            const multipliers = {
                'ca': 1.0,
                'go': 0.8,
                'so': 1.2,
                'os': 0.9
            };
            return basePfa * (multipliers[cfarType] || 1.0);
        }

        // 检查距离约束
        function checkRangeConstraint(maxRange, maxUnambiguousRange) {
            const rangeElement = document.getElementById('maxRange');
            const unambiguousElement = document.getElementById('maxUnambiguousRange');
            
            if (maxRange > maxUnambiguousRange) {
                // 违反约束：探测距离 > 不模糊距离
                rangeElement.style.color = '#ff4444';
                rangeElement.title = '警告：探测距离超过不模糊距离，会产生距离模糊！';
                unambiguousElement.style.color = '#ff9800';
                unambiguousElement.title = '建议：降低PRF或接受距离模糊';
                
                // 显示约束违反警告
                showConstraintWarning(maxRange, maxUnambiguousRange);
            } else {
                // 满足约束
                rangeElement.style.color = '#4CAF50';
                rangeElement.title = '探测距离在不模糊范围内';
                unambiguousElement.style.color = '#4CAF50';
                unambiguousElement.title = '不模糊距离充足';
                
                // 隐藏警告
                hideConstraintWarning();
            }
        }
        
        // 显示约束违反警告
        function showConstraintWarning(maxRange, maxUnambiguousRange) {
            let warningDiv = document.getElementById('constraintWarning');
            if (!warningDiv) {
                warningDiv = document.createElement('div');
                warningDiv.id = 'constraintWarning';
                warningDiv.style.cssText = `
                    background: rgba(255, 68, 68, 0.1);
                    border: 1px solid #ff4444;
                    border-radius: 8px;
                    padding: 15px;
                    margin: 10px 0;
                    color: #ff4444;
                    font-size: 0.9em;
                    animation: pulse 2s ease-in-out infinite;
                `;
                document.querySelector('.results').appendChild(warningDiv);
            }
            
            const ambiguousRange = maxRange - maxUnambiguousRange;
            const ambiguousPercent = (ambiguousRange / maxRange * 100).toFixed(1);
            
            warningDiv.innerHTML = `
                <strong>⚠️ 距离约束违反警告</strong><br>
                探测距离 (${maxRange.toFixed(1)} km) > 不模糊距离 (${maxUnambiguousRange.toFixed(1)} km)<br>
                模糊范围：${ambiguousRange.toFixed(1)} km (${ambiguousPercent}%)<br>
                <small>建议：降低PRF至 ${(CONSTANTS.C / (2 * maxRange * 1000)).toFixed(0)} Hz 或使用解模糊技术</small>
            `;
        }
        
        // 隐藏约束警告
        function hideConstraintWarning() {
            const warningDiv = document.getElementById('constraintWarning');
            if (warningDiv) {
                warningDiv.remove();
            }
        }
        
        // 理论验证函数
        function validateTheory(pcGain, ciGain, nciGain, pcRatio, ciPulses, nciTimes) {
            const theoryElement = document.getElementById('theoryValidation');
            let validationErrors = [];
            
            // 验证脉冲压缩增益公式：10×log10(压缩比)
            const expectedPcGain = 10 * Math.log10(pcRatio);
            if (Math.abs(pcGain - expectedPcGain) > 0.01) {
                validationErrors.push('脉冲压缩增益计算错误');
            }
            
            // 验证相干积累增益公式：10×log10(脉冲数)
            const expectedCiGain = 10 * Math.log10(ciPulses);
            if (Math.abs(ciGain - expectedCiGain) > 0.01) {
                validationErrors.push('相干积累增益计算错误');
            }
            
            // 验证非相干积累增益公式：5×log10(积累次数)，当积累次数为0时跳过验证
            if (nciTimes > 0) {
                const expectedNciGain = 5 * Math.log10(nciTimes);
                if (Math.abs(nciGain - expectedNciGain) > 0.01) {
                    validationErrors.push('非相干积累增益计算错误');
                }
            } else {
                // 当非相干积累次数为0时，增益应该为0
                if (Math.abs(nciGain - 0) > 0.01) {
                    validationErrors.push('非相干积累增益计算错误：应为0dB');
                }
            }
            
            // 更新验证状态
            if (validationErrors.length === 0) {
                theoryElement.textContent = '✓ 公式正确';
                theoryElement.style.color = '#4CAF50';
                theoryElement.title = '所有理论公式验证通过';
            } else {
                theoryElement.textContent = '⚠️ 公式异常';
                theoryElement.style.color = '#ff9800';
                theoryElement.title = '发现问题: ' + validationErrors.join(', ');
            }
        }

        // 更新性能指示器
        function updatePerformanceIndicator(range, pd) {
            const performance = Math.min((range / 100) * 0.5 + pd * 0.5, 1) * 100;
            document.getElementById('performanceBar').style.width = performance + '%';
            document.getElementById('performanceText').textContent = performance.toFixed(0) + '%';
        }

        // 更新扫描模式动画
        function updateScanAnimation() {
            const scanMode = elements.scanMode.value;
            const scanRate = parseFloat(elements.scanRate.value);
            const dwellTime = parseFloat(elements.dwellTime.value);
            const sweep = document.querySelector('.radar-sweep');
            
            // 计算动画持续时间
            let animationDuration;
            let animationName;
            
            switch (scanMode) {
                case 'circular':
                    animationDuration = 360 / scanRate; // 完整圆扫时间
                    animationName = 'sweep-circular';
                    break;
                case 'sector':
                    animationDuration = (90 / scanRate) * 2; // 扇扫往返时间
                    animationName = 'sweep-sector';
                    break;
                case 'track':
                    animationDuration = dwellTime / 250; // 跟踪模式慢速摆动
                    animationName = 'sweep-track';
                    break;
                case 'search':
                    animationDuration = 360 / scanRate * 1.5; // 搜索模式分步扫描
                    animationName = 'sweep-search';
                    break;
                default:
                    animationDuration = 3;
                    animationName = 'sweep-circular';
            }
            
            sweep.style.animation = `${animationName} ${animationDuration}s linear infinite`;
        }

        // 更新目标位置
        function updateTargetPosition(range) {
            const target = document.getElementById('target');
            const maxDisplayRange = 100; // km
            const radarRadius = 180; // px
            const scanMode = elements.scanMode.value;
            
            let displayRange = Math.min(range, maxDisplayRange);
            let distance = (displayRange / maxDisplayRange) * radarRadius;
            
            // 根据扫描模式调整目标位置
            let angle;
            switch (scanMode) {
                case 'circular':
                    angle = (Date.now() / 50) % 360;
                    break;
                case 'sector':
                    const sectorTime = (Date.now() / 50) % 180;
                    angle = sectorTime > 90 ? 180 - sectorTime : sectorTime;
                    angle -= 45; // 中心在0度
                    break;
                case 'track':
                    angle = Math.sin(Date.now() / 1000) * 20; // ±20度摆动
                    break;
                case 'search':
                    const searchStep = Math.floor((Date.now() / 1000) % 5);
                    angle = searchStep * 72; // 5个方向搜索
                    break;
                default:
                    angle = (Date.now() / 50) % 360;
            }
            
            const radian = (angle * Math.PI) / 180;
            const x = Math.cos(radian) * distance;
            const y = Math.sin(radian) * distance;
            
            target.style.left = `calc(50% + ${x}px)`;
            target.style.top = `calc(50% + ${y}px)`;
            
            // 如果超出最大显示范围，调整透明度
            target.style.opacity = range > maxDisplayRange ? '0.3' : '1';
        }

        // 切换理论说明面板

         

         

        
        // 绘制波形
        function drawWaveform() {
            const canvas = document.getElementById('waveformCanvas');
            const ctx = canvas.getContext('2d');
            const waveformType = elements.waveformType.value;
            const pulseWidth = parseFloat(elements.pulseWidth.value);
            const bandwidth = parseFloat(elements.bandwidth.value);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制网格
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 6; i++) {
                const y = (canvas.height / 6) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            for (let i = 0; i <= 10; i++) {
                const x = (canvas.width / 10) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // 绘制波形
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const centerY = canvas.height / 2;
            const amplitude = canvas.height * 0.3;
            
            for (let x = 0; x < canvas.width; x++) {
                const t = (x / canvas.width) * pulseWidth * 2;
                let y = centerY;
                
                if (t < pulseWidth) {
                    switch (waveformType) {
                        case 'rect':
                            y = centerY - amplitude;
                            break;
                        case 'lfm':
                            const freq = 2 * Math.PI * bandwidth * t / pulseWidth;
                            y = centerY - amplitude * Math.sin(freq * t);
                            break;
                        case 'bpsk':
                            const phase = Math.floor(t / (pulseWidth / 8)) % 2 === 0 ? 0 : Math.PI;
                            y = centerY - amplitude * Math.sin(2 * Math.PI * 10 * t + phase);
                            break;
                        case 'qpsk':
                            const qphase = Math.floor(t / (pulseWidth / 4)) % 4 * Math.PI / 2;
                            y = centerY - amplitude * Math.sin(2 * Math.PI * 10 * t + qphase);
                            break;
                    }
                }
                
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // 添加标签
            ctx.fillStyle = 'white';
            ctx.font = '12px Microsoft YaHei';
            ctx.fillText(`波形: ${getWaveformName(waveformType)}`, 10, 20);
            ctx.fillText(`脉宽: ${pulseWidth}μs`, 10, 35);
            ctx.fillText(`带宽: ${bandwidth}MHz`, 10, 50);
        }

        // 获取波形名称
        function getWaveformName(type) {
            const names = {
                'rect': '矩形脉冲',
                'lfm': '线性调频',
                'bpsk': '二相编码',
                'qpsk': '四相编码'
            };
            return names[type] || type;
        }

        // 应用手动输入的参数值
        function applyManualInput(paramId) {
            const inputElement = document.getElementById(paramId + 'Input');
            const sliderElement = document.getElementById(paramId);
            const valueElement = document.getElementById(paramId + 'Value');
            
            if (!inputElement || !sliderElement || !valueElement) {
                console.error('找不到参数元素:', paramId);
                return;
            }
            
            const inputValue = parseFloat(inputElement.value);
            const min = parseFloat(sliderElement.min);
            const max = parseFloat(sliderElement.max);
            
            // 验证输入值范围
            if (isNaN(inputValue)) {
                alert('请输入有效的数值');
                return;
            }
            
            if (inputValue < min || inputValue > max) {
                alert(`参数值必须在 ${min} 到 ${max} 之间`);
                return;
            }
            
            // 更新滑块值
            sliderElement.value = inputValue;
            
            // 更新显示值
            updateParameterDisplay(paramId, inputValue);
            
            // 清空输入框
            inputElement.value = '';
            
            // 重新计算
            updateCalculation();
        }
        
        // 更新参数显示值
        function updateParameterDisplay(paramId, value) {
            const valueElement = document.getElementById(paramId + 'Value');
            
            switch(paramId) {
                case 'pt':
                    valueElement.textContent = value + ' W';
                    break;
                case 'gt':
                case 'gr':
                case 'snr':
                case 'cfarLoss':
                case 'noiseFigure':
                case 'systemLoss':
                    valueElement.textContent = value + ' dB';
                    break;
                case 'sigma':
                    valueElement.textContent = value + ' m²';
                    break;
                case 'freq':
                    valueElement.textContent = value + ' GHz';
                    break;
                case 'coherentIntegration':
                case 'nonCoherentIntegration':
                    valueElement.textContent = value;
                    break;
                case 'pulseWidth':
                    valueElement.textContent = value + ' μs';
                    break;
                case 'bandwidth':
                    valueElement.textContent = value + ' MHz';
                    break;
                case 'prf':
                    valueElement.textContent = value + ' Hz';
                    break;
                case 'dwellTime':
                    valueElement.textContent = value + ' ms';
                    break;
                case 'beamWidth':
                case 'scanRate':
                    valueElement.textContent = value + (paramId === 'beamWidth' ? '°' : ' °/s');
                    break;
                default:
                    valueElement.textContent = value;
            }
        }
        
        // 为手动输入框添加回车键支持
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('.parameter-manual-input');
            inputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const paramId = this.id.replace('Input', '');
                        applyManualInput(paramId);
                    }
                });
            });
        });
        
        // 更新计算详情显示
        function updateCalculationDetails(params) {
            const {
                pt, gt, gr, sigma, lambda, pulseWidth, noiseFigure, systemLoss, snr, cfarLoss,
                ptDb, sigmaDb, pulseWidthDb, lambdaDb, kDb, tDb, zfDb,
                pcGain, ciGain, nciGain, numerator, denominator, r4db, r4, maxRange
            } = params;
            
            // 更新分子部分
            document.getElementById('ptCalc').textContent = `${pt.toFixed(0)} W (${ptDb.toFixed(1)} dB)`;
            document.getElementById('gtCalc').textContent = `${gt.toFixed(1)} dB`;
            document.getElementById('grCalc').textContent = `${gr.toFixed(1)} dB`;
            document.getElementById('lambdaCalc').textContent = `${(lambda * lambda).toExponential(3)} m² (${lambdaDb.toFixed(1)} dB)`;
            document.getElementById('sigmaCalc').textContent = `${sigma.toFixed(4)} m² (${sigmaDb.toFixed(1)} dB)`;
            document.getElementById('tauCalc').textContent = `${(pulseWidth * 1e6).toFixed(1)} μs (${pulseWidthDb.toFixed(1)} dB)`;
            document.getElementById('pcGainCalc').textContent = `${pcGain.toFixed(1)} dB`;
            document.getElementById('ciGainCalc').textContent = `${ciGain.toFixed(1)} dB`;
            document.getElementById('nciGainCalc').textContent = `${nciGain.toFixed(1)} dB`;
            
            // 重新计算分子总和，只包含界面显示的项目（不包含MTD）
            const displayedNumerator = ptDb + gt + gr + lambdaDb + sigmaDb + pulseWidthDb + pcGain + ciGain + nciGain;
            document.getElementById('numeratorTotal').textContent = `${displayedNumerator.toFixed(1)} dB`;
            
            // 更新分母部分
            document.getElementById('kCalc').textContent = `1.38×10⁻²³ J/K (${kDb.toFixed(1)} dB)`;
            document.getElementById('tCalc').textContent = `290 K (${tDb.toFixed(1)} dB)`;
            document.getElementById('fCalc').textContent = `${noiseFigure.toFixed(1)} dB`;
            document.getElementById('lCalc').textContent = `${systemLoss.toFixed(1)} dB`;
            document.getElementById('snrCalc').textContent = `${snr.toFixed(1)} dB`;
            document.getElementById('geometryCalc').textContent = `${Math.pow(4 * Math.PI, 3).toFixed(1)} (${zfDb.toFixed(1)} dB)`;
            document.getElementById('cfarCalc').textContent = `${cfarLoss.toFixed(1)} dB`;
            document.getElementById('denominatorTotal').textContent = `${denominator.toFixed(1)} dB`;
            
            // 重新计算R^4 (dB)，基于显示的分子分母
            const displayedR4db = displayedNumerator - denominator;
            const displayedR4 = Math.pow(10, displayedR4db / 10);
            const displayedMaxRange = Math.pow(displayedR4, 1/4) / 1000;
            
            // 更新最终计算
            document.getElementById('r4dbCalc').textContent = `${displayedR4db.toFixed(1)} dB`;
            document.getElementById('r4linearCalc').textContent = `${displayedR4.toExponential(3)}`;
            document.getElementById('finalRangeCalc').textContent = `${displayedMaxRange.toFixed(2)} km`;
            
            // 返回修正后的探测距离
            return displayedMaxRange;
        }
        
        // 重置参数
        function resetParameters() {
            // 基本参数
            elements.pt.value = 480;
            elements.gt.value = 25.6;
            elements.gr.value = 34;
            elements.sigma.value = 0.01;
            elements.snr.value = 12.8;
            elements.freq.value = 10;
            elements.noiseFigure.value = 4;
            elements.systemLoss.value = 8.24;
            
            // 信号处理参数（脉冲压缩比是自动计算的，不需要重置）
            elements.coherentIntegration.value = 192;
            elements.nonCoherentIntegration.value = 0;
            elements.cfarType.value = 'ca';
            elements.cfarLoss.value = 0;
            
            // 波形参数
            elements.waveformType.value = 'lfm';
            elements.pulseWidth.value = 20;
            elements.bandwidth.value = 0.1;
            elements.prf.value = 10000;
            
            // 工作模式参数
            elements.scanMode.value = 'circular';
            elements.dwellTime.value = 100;
            elements.beamWidth.value = 2;
            elements.scanRate.value = 60;
            
            // 更新所有参数显示值
            updateDisplayValues();
            
            // 重新计算
            updateCalculation();
        }

        // 绘制图表
        function drawChart() {
            const canvas = document.getElementById('chartCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制网格
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 12; i++) {
                const x = (canvas.width / 12) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let i = 0; i <= 6; i++) {
                const y = (canvas.height / 6) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // 绘制标题
            ctx.fillStyle = 'white';
            ctx.font = '16px Microsoft YaHei';
            ctx.textAlign = 'center';
            ctx.fillText('高级雷达性能分析', canvas.width / 2, 25);
        }

        // 显示高级分析








        // 页面加载完成后初始化
        window.addEventListener('load', init);
    </script>
</body>
</html>